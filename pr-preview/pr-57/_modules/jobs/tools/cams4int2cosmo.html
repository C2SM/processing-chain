<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>jobs.tools.cams4int2cosmo &mdash; Processing Chain v3.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=09616d5f" />

  
    <link rel="shortcut icon" href="../../../_static/processing-chain-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=de725823"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=a5fa425f"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #5d6d7e" >

          
          
          <a href="../../../index.html">
            
              <img src="../../../_static/processing-chain-logo-small.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v3.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Feature Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environment.html">Conda Environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../environment.html#install-miniconda">1. Install Miniconda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../environment.html#create-the-conda-environment">2. Create the Conda Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../environment.html#store-user-specific-data">3. Store user-specific data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../howtorun.html">How to Run</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../howtorun.html#starting-the-chain">Starting the Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../howtorun.html#what-it-does">What it Does</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../howtorun.html#test-cases">Test Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../howtorun.html#directory-structure">Directory Structure</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../code-structure.html">Code Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../config.html">Configuration File</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../config.html#configuration-variables">Configuration Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../config.html#variables-to-set-in-config-yaml">Variables to Set in <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../namelists.html">Namelist and Runscript Templates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../namelists.html#jobs.tools.write_int2lm_input_art.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.write_int2lm_input_art.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../namelists.html#jobs.tools.write_cosmo_input_ghg.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.write_cosmo_input_ghg.main()</span></code></a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Jobs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../jobs.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../jobs.html#adding-new-jobs">Adding New Jobs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../functions.html">Jobs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.biofluxes.main"><code class="docutils literal notranslate"><span class="pre">jobs.biofluxes.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.check_output.main"><code class="docutils literal notranslate"><span class="pre">jobs.check_output.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.cosmo.main"><code class="docutils literal notranslate"><span class="pre">jobs.cosmo.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.emissions.main"><code class="docutils literal notranslate"><span class="pre">jobs.emissions.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.icon.main"><code class="docutils literal notranslate"><span class="pre">jobs.icon.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.int2lm.main"><code class="docutils literal notranslate"><span class="pre">jobs.int2lm.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.obs_nudging.main"><code class="docutils literal notranslate"><span class="pre">jobs.obs_nudging.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.octe.main"><code class="docutils literal notranslate"><span class="pre">jobs.octe.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.oem.main"><code class="docutils literal notranslate"><span class="pre">jobs.oem.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.online_vprm.main"><code class="docutils literal notranslate"><span class="pre">jobs.online_vprm.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.photo_rate.main"><code class="docutils literal notranslate"><span class="pre">jobs.photo_rate.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.post_cosmo.main"><code class="docutils literal notranslate"><span class="pre">jobs.post_cosmo.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.post_int2lm.main"><code class="docutils literal notranslate"><span class="pre">jobs.post_int2lm.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.prepare_data.main"><code class="docutils literal notranslate"><span class="pre">jobs.prepare_data.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.reduce_output.main"><code class="docutils literal notranslate"><span class="pre">jobs.reduce_output.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.verify_chain.main"><code class="docutils literal notranslate"><span class="pre">jobs.verify_chain.main()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../functions.html#tools">Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.cams4int2cosmo.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.cams4int2cosmo.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.check_model.check_model"><code class="docutils literal notranslate"><span class="pre">jobs.tools.check_model.check_model()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.comp_nc.datasets_equal"><code class="docutils literal notranslate"><span class="pre">jobs.tools.comp_nc.datasets_equal()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.ctnoaa4int2cosmo.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.ctnoaa4int2cosmo.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.mozart2int2lm.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.mozart2int2lm.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.reduce_output_start_end.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.reduce_output_start_end.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.string2char.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.string2char.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.vprmsplit.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.vprmsplit.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.write_cosmo_input_ghg.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.write_cosmo_input_ghg.main()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../functions.html#jobs.tools.write_int2lm_input_art.main"><code class="docutils literal notranslate"><span class="pre">jobs.tools.write_int2lm_input_art.main()</span></code></a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #5d6d7e" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Processing Chain</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">jobs.tools.cams4int2cosmo</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for jobs.tools.cams4int2cosmo</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Author: Dominik Brunner (DB), Empa, Switzerland</span>
<span class="c1">#       DB, 15 May 2017: first implementation on daint.cscs.ch</span>
<span class="c1">#       DB, 06 Jun 2017: modified to add surface pressure fields</span>
<span class="c1">#       hjm, 22 Jun 2018: Translated to Python</span>
<span class="c1">######################</span>
<span class="c1">## Problems:</span>
<span class="c1">## - when comparing to the &quot;processed2&quot; icbc form Gerrit, PSURF is slightly different</span>
<span class="c1">## - when checking the website, the b levels are not the same as in CAMS</span>
<span class="c1">## - It is not possible to delete a variable from a netcdf4 file, so resort to calling ncks at the end</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">importlib</span>

<span class="c1">###############################</span>
<span class="c1">##  Constants : CAMS levels  ##</span>
<span class="c1">###############################</span>
<span class="c1"># hybrid coefficients of the 137 model level version</span>
<span class="c1"># http://www.ecmwf.int/en/forecasts/documentation-and-support/137-model-levels</span>
<span class="n">a_half_137</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">2.0003650188e+00</span><span class="p">,</span> <span class="mf">3.1022410393e+00</span><span class="p">,</span> <span class="mf">4.6660838127e+00</span><span class="p">,</span>
    <span class="mf">6.8279771805e+00</span><span class="p">,</span> <span class="mf">9.7469663620e+00</span><span class="p">,</span> <span class="mf">1.3605423927e+01</span><span class="p">,</span> <span class="mf">1.8608930588e+01</span><span class="p">,</span>
    <span class="mf">2.4985717773e+01</span><span class="p">,</span> <span class="mf">3.2985710144e+01</span><span class="p">,</span> <span class="mf">4.2879241943e+01</span><span class="p">,</span> <span class="mf">5.4955463409e+01</span><span class="p">,</span>
    <span class="mf">6.9520576477e+01</span><span class="p">,</span> <span class="mf">8.6895881653e+01</span><span class="p">,</span> <span class="mf">1.0741574097e+02</span><span class="p">,</span> <span class="mf">1.3142550659e+02</span><span class="p">,</span>
    <span class="mf">1.5927940369e+02</span><span class="p">,</span> <span class="mf">1.9133856201e+02</span><span class="p">,</span> <span class="mf">2.2796894836e+02</span><span class="p">,</span> <span class="mf">2.6953958130e+02</span><span class="p">,</span>
    <span class="mf">3.1642074585e+02</span><span class="p">,</span> <span class="mf">3.6898236084e+02</span><span class="p">,</span> <span class="mf">4.2759249878e+02</span><span class="p">,</span> <span class="mf">4.9261602783e+02</span><span class="p">,</span>
    <span class="mf">5.6441345215e+02</span><span class="p">,</span> <span class="mf">6.4333990479e+02</span><span class="p">,</span> <span class="mf">7.2974414062e+02</span><span class="p">,</span> <span class="mf">8.2396783447e+02</span><span class="p">,</span>
    <span class="mf">9.2634490967e+02</span><span class="p">,</span> <span class="mf">1.0372011719e+03</span><span class="p">,</span> <span class="mf">1.1568536377e+03</span><span class="p">,</span> <span class="mf">1.2856103516e+03</span><span class="p">,</span>
    <span class="mf">1.4237701416e+03</span><span class="p">,</span> <span class="mf">1.5716229248e+03</span><span class="p">,</span> <span class="mf">1.7294489746e+03</span><span class="p">,</span> <span class="mf">1.8975192871e+03</span><span class="p">,</span>
    <span class="mf">2.0760959473e+03</span><span class="p">,</span> <span class="mf">2.2654316406e+03</span><span class="p">,</span> <span class="mf">2.4657705078e+03</span><span class="p">,</span> <span class="mf">2.6773481445e+03</span><span class="p">,</span>
    <span class="mf">2.9003913574e+03</span><span class="p">,</span> <span class="mf">3.1351193848e+03</span><span class="p">,</span> <span class="mf">3.3817436523e+03</span><span class="p">,</span> <span class="mf">3.6404682617e+03</span><span class="p">,</span>
    <span class="mf">3.9114904785e+03</span><span class="p">,</span> <span class="mf">4.1949306641e+03</span><span class="p">,</span> <span class="mf">4.4908173828e+03</span><span class="p">,</span> <span class="mf">4.7991494141e+03</span><span class="p">,</span>
    <span class="mf">5.1198950195e+03</span><span class="p">,</span> <span class="mf">5.4529907227e+03</span><span class="p">,</span> <span class="mf">5.7983447266e+03</span><span class="p">,</span> <span class="mf">6.1560742188e+03</span><span class="p">,</span>
    <span class="mf">6.5269467773e+03</span><span class="p">,</span> <span class="mf">6.9118706055e+03</span><span class="p">,</span> <span class="mf">7.3118691406e+03</span><span class="p">,</span> <span class="mf">7.7274121094e+03</span><span class="p">,</span>
    <span class="mf">8.1593540039e+03</span><span class="p">,</span> <span class="mf">8.6085253906e+03</span><span class="p">,</span> <span class="mf">9.0764003906e+03</span><span class="p">,</span> <span class="mf">9.5626826172e+03</span><span class="p">,</span>
    <span class="mf">1.0065978516e+04</span><span class="p">,</span> <span class="mf">1.0584631836e+04</span><span class="p">,</span> <span class="mf">1.1116662109e+04</span><span class="p">,</span> <span class="mf">1.1660067383e+04</span><span class="p">,</span>
    <span class="mf">1.2211547852e+04</span><span class="p">,</span> <span class="mf">1.2766873047e+04</span><span class="p">,</span> <span class="mf">1.3324668945e+04</span><span class="p">,</span> <span class="mf">1.3881331055e+04</span><span class="p">,</span>
    <span class="mf">1.4432139648e+04</span><span class="p">,</span> <span class="mf">1.4975615234e+04</span><span class="p">,</span> <span class="mf">1.5508256836e+04</span><span class="p">,</span> <span class="mf">1.6026115234e+04</span><span class="p">,</span>
    <span class="mf">1.6527322266e+04</span><span class="p">,</span> <span class="mf">1.7008789062e+04</span><span class="p">,</span> <span class="mf">1.7467613281e+04</span><span class="p">,</span> <span class="mf">1.7901621094e+04</span><span class="p">,</span>
    <span class="mf">1.8308433594e+04</span><span class="p">,</span> <span class="mf">1.8685718750e+04</span><span class="p">,</span> <span class="mf">1.9031289062e+04</span><span class="p">,</span> <span class="mf">1.9343511719e+04</span><span class="p">,</span>
    <span class="mf">1.9620042969e+04</span><span class="p">,</span> <span class="mf">1.9859390625e+04</span><span class="p">,</span> <span class="mf">2.0059931641e+04</span><span class="p">,</span> <span class="mf">2.0219664062e+04</span><span class="p">,</span>
    <span class="mf">2.0337863281e+04</span><span class="p">,</span> <span class="mf">2.0412308594e+04</span><span class="p">,</span> <span class="mf">2.0442078125e+04</span><span class="p">,</span> <span class="mf">2.0425718750e+04</span><span class="p">,</span>
    <span class="mf">2.0361816406e+04</span><span class="p">,</span> <span class="mf">2.0249511719e+04</span><span class="p">,</span> <span class="mf">2.0087085938e+04</span><span class="p">,</span> <span class="mf">1.9874025391e+04</span><span class="p">,</span>
    <span class="mf">1.9608572266e+04</span><span class="p">,</span> <span class="mf">1.9290226562e+04</span><span class="p">,</span> <span class="mf">1.8917460938e+04</span><span class="p">,</span> <span class="mf">1.8489707031e+04</span><span class="p">,</span>
    <span class="mf">1.8006925781e+04</span><span class="p">,</span> <span class="mf">1.7471839844e+04</span><span class="p">,</span> <span class="mf">1.6888687500e+04</span><span class="p">,</span> <span class="mf">1.6262046875e+04</span><span class="p">,</span>
    <span class="mf">1.5596695312e+04</span><span class="p">,</span> <span class="mf">1.4898453125e+04</span><span class="p">,</span> <span class="mf">1.4173324219e+04</span><span class="p">,</span> <span class="mf">1.3427769531e+04</span><span class="p">,</span>
    <span class="mf">1.2668257812e+04</span><span class="p">,</span> <span class="mf">1.1901339844e+04</span><span class="p">,</span> <span class="mf">1.1133304688e+04</span><span class="p">,</span> <span class="mf">1.0370175781e+04</span><span class="p">,</span>
    <span class="mf">9.6175156250e+03</span><span class="p">,</span> <span class="mf">8.8804531250e+03</span><span class="p">,</span> <span class="mf">8.1633750000e+03</span><span class="p">,</span> <span class="mf">7.4703437500e+03</span><span class="p">,</span>
    <span class="mf">6.8044218750e+03</span><span class="p">,</span> <span class="mf">6.1685312500e+03</span><span class="p">,</span> <span class="mf">5.5643828125e+03</span><span class="p">,</span> <span class="mf">4.9937968750e+03</span><span class="p">,</span>
    <span class="mf">4.4573750000e+03</span><span class="p">,</span> <span class="mf">3.9559609375e+03</span><span class="p">,</span> <span class="mf">3.4892343750e+03</span><span class="p">,</span> <span class="mf">3.0572656250e+03</span><span class="p">,</span>
    <span class="mf">2.6591406250e+03</span><span class="p">,</span> <span class="mf">2.2942421875e+03</span><span class="p">,</span> <span class="mf">1.9615000000e+03</span><span class="p">,</span> <span class="mf">1.6594765625e+03</span><span class="p">,</span>
    <span class="mf">1.3875468750e+03</span><span class="p">,</span> <span class="mf">1.1432500000e+03</span><span class="p">,</span> <span class="mf">9.2650781250e+02</span><span class="p">,</span> <span class="mf">7.3499218750e+02</span><span class="p">,</span>
    <span class="mf">5.6806250000e+02</span><span class="p">,</span> <span class="mf">4.2441406250e+02</span><span class="p">,</span> <span class="mf">3.0247656250e+02</span><span class="p">,</span> <span class="mf">2.0248437500e+02</span><span class="p">,</span>
    <span class="mf">1.2210156250e+02</span><span class="p">,</span> <span class="mf">6.2781250000e+01</span><span class="p">,</span> <span class="mf">2.2835937500e+01</span><span class="p">,</span> <span class="mf">3.7578129768e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span>
<span class="p">]</span>
<span class="n">b_half_137</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">3.8199999608e-08</span><span class="p">,</span> <span class="mf">6.7607002165e-06</span><span class="p">,</span>
    <span class="mf">2.4348000807e-05</span><span class="p">,</span> <span class="mf">5.8921999880e-05</span><span class="p">,</span> <span class="mf">1.1191429803e-04</span><span class="p">,</span> <span class="mf">1.9857739971e-04</span><span class="p">,</span>
    <span class="mf">3.4037968726e-04</span><span class="p">,</span> <span class="mf">5.6155532366e-04</span><span class="p">,</span> <span class="mf">8.8969792705e-04</span><span class="p">,</span> <span class="mf">1.3528055279e-03</span><span class="p">,</span>
    <span class="mf">1.9918379840e-03</span><span class="p">,</span> <span class="mf">2.8571242001e-03</span><span class="p">,</span> <span class="mf">3.9709536359e-03</span><span class="p">,</span> <span class="mf">5.3778146394e-03</span><span class="p">,</span>
    <span class="mf">7.1333767846e-03</span><span class="p">,</span> <span class="mf">9.2614600435e-03</span><span class="p">,</span> <span class="mf">1.1806022376e-02</span><span class="p">,</span> <span class="mf">1.4815628529e-02</span><span class="p">,</span>
    <span class="mf">1.8318451941e-02</span><span class="p">,</span> <span class="mf">2.2354844958e-02</span><span class="p">,</span> <span class="mf">2.6963520795e-02</span><span class="p">,</span> <span class="mf">3.2176095992e-02</span><span class="p">,</span>
    <span class="mf">3.8026399910e-02</span><span class="p">,</span> <span class="mf">4.4547960162e-02</span><span class="p">,</span> <span class="mf">5.1773015410e-02</span><span class="p">,</span> <span class="mf">5.9728413820e-02</span><span class="p">,</span>
    <span class="mf">6.8448252976e-02</span><span class="p">,</span> <span class="mf">7.7958308160e-02</span><span class="p">,</span> <span class="mf">8.8285736740e-02</span><span class="p">,</span> <span class="mf">9.9461667240e-02</span><span class="p">,</span>
    <span class="mf">1.1150465161e-01</span><span class="p">,</span> <span class="mf">1.2444812804e-01</span><span class="p">,</span> <span class="mf">1.3831289113e-01</span><span class="p">,</span> <span class="mf">1.5312503278e-01</span><span class="p">,</span>
    <span class="mf">1.6891041398e-01</span><span class="p">,</span> <span class="mf">1.8568944931e-01</span><span class="p">,</span> <span class="mf">2.0349121094e-01</span><span class="p">,</span> <span class="mf">2.2233286500e-01</span><span class="p">,</span>
    <span class="mf">2.4224400520e-01</span><span class="p">,</span> <span class="mf">2.6324188709e-01</span><span class="p">,</span> <span class="mf">2.8535401821e-01</span><span class="p">,</span> <span class="mf">3.0859845877e-01</span><span class="p">,</span>
    <span class="mf">3.3293908834e-01</span><span class="p">,</span> <span class="mf">3.5825419426e-01</span><span class="p">,</span> <span class="mf">3.8436332345e-01</span><span class="p">,</span> <span class="mf">4.1112476587e-01</span><span class="p">,</span>
    <span class="mf">4.3839120865e-01</span><span class="p">,</span> <span class="mf">4.6600329876e-01</span><span class="p">,</span> <span class="mf">4.9380031228e-01</span><span class="p">,</span> <span class="mf">5.2161920071e-01</span><span class="p">,</span>
    <span class="mf">5.4930114746e-01</span><span class="p">,</span> <span class="mf">5.7669216394e-01</span><span class="p">,</span> <span class="mf">6.0364806652e-01</span><span class="p">,</span> <span class="mf">6.3003581762e-01</span><span class="p">,</span>
    <span class="mf">6.5573596954e-01</span><span class="p">,</span> <span class="mf">6.8064302206e-01</span><span class="p">,</span> <span class="mf">7.0466899872e-01</span><span class="p">,</span> <span class="mf">7.2773873806e-01</span><span class="p">,</span>
    <span class="mf">7.4979656935e-01</span><span class="p">,</span> <span class="mf">7.7079755068e-01</span><span class="p">,</span> <span class="mf">7.9071676731e-01</span><span class="p">,</span> <span class="mf">8.0953603983e-01</span><span class="p">,</span>
    <span class="mf">8.2725608349e-01</span><span class="p">,</span> <span class="mf">8.4388113022e-01</span><span class="p">,</span> <span class="mf">8.5943180323e-01</span><span class="p">,</span> <span class="mf">8.7392926216e-01</span><span class="p">,</span>
    <span class="mf">8.8740754128e-01</span><span class="p">,</span> <span class="mf">8.9990049601e-01</span><span class="p">,</span> <span class="mf">9.1144818068e-01</span><span class="p">,</span> <span class="mf">9.2209565639e-01</span><span class="p">,</span>
    <span class="mf">9.3188077211e-01</span><span class="p">,</span> <span class="mf">9.4085955620e-01</span><span class="p">,</span> <span class="mf">9.4906443357e-01</span><span class="p">,</span> <span class="mf">9.5654952526e-01</span><span class="p">,</span>
    <span class="mf">9.6335172653e-01</span><span class="p">,</span> <span class="mf">9.6951341629e-01</span><span class="p">,</span> <span class="mf">9.7507840395e-01</span><span class="p">,</span> <span class="mf">9.8007160425e-01</span><span class="p">,</span>
    <span class="mf">9.8454189301e-01</span><span class="p">,</span> <span class="mf">9.8849952221e-01</span><span class="p">,</span> <span class="mf">9.9198400974e-01</span><span class="p">,</span> <span class="mf">9.9500250816e-01</span><span class="p">,</span>
    <span class="mf">9.9763011932e-01</span><span class="p">,</span> <span class="mf">1.0000000000e+00</span>
<span class="p">]</span>

<span class="c1"># hybrid coefficients of the 60 model level version</span>
<span class="c1"># http://www.ecmwf.int/en/forecasts/documentation-and-support/60-model-levels</span>
<span class="n">a_half_60</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">2.0000000000e+01</span><span class="p">,</span> <span class="mf">3.8425338745e+01</span><span class="p">,</span> <span class="mf">6.3647796631e+01</span><span class="p">,</span>
    <span class="mf">9.5636962891e+01</span><span class="p">,</span> <span class="mf">1.3448330688e+02</span><span class="p">,</span> <span class="mf">1.8058435059e+02</span><span class="p">,</span> <span class="mf">2.3477905273e+02</span><span class="p">,</span>
    <span class="mf">2.9849584961e+02</span><span class="p">,</span> <span class="mf">3.7397192383e+02</span><span class="p">,</span> <span class="mf">4.6461816406e+02</span><span class="p">,</span> <span class="mf">5.7565112305e+02</span><span class="p">,</span>
    <span class="mf">7.1321801758e+02</span><span class="p">,</span> <span class="mf">8.8366040039e+02</span><span class="p">,</span> <span class="mf">1.0948347168e+03</span><span class="p">,</span> <span class="mf">1.3564746094e+03</span><span class="p">,</span>
    <span class="mf">1.6806403809e+03</span><span class="p">,</span> <span class="mf">2.0822739258e+03</span><span class="p">,</span> <span class="mf">2.5798886719e+03</span><span class="p">,</span> <span class="mf">3.1964216309e+03</span><span class="p">,</span>
    <span class="mf">3.9602915039e+03</span><span class="p">,</span> <span class="mf">4.9067070312e+03</span><span class="p">,</span> <span class="mf">6.0180195312e+03</span><span class="p">,</span> <span class="mf">7.3066328125e+03</span><span class="p">,</span>
    <span class="mf">8.7650546875e+03</span><span class="p">,</span> <span class="mf">1.0376125000e+04</span><span class="p">,</span> <span class="mf">1.2077445312e+04</span><span class="p">,</span> <span class="mf">1.3775324219e+04</span><span class="p">,</span>
    <span class="mf">1.5379804688e+04</span><span class="p">,</span> <span class="mf">1.6819472656e+04</span><span class="p">,</span> <span class="mf">1.8045183594e+04</span><span class="p">,</span> <span class="mf">1.9027695312e+04</span><span class="p">,</span>
    <span class="mf">1.9755109375e+04</span><span class="p">,</span> <span class="mf">2.0222203125e+04</span><span class="p">,</span> <span class="mf">2.0429863281e+04</span><span class="p">,</span> <span class="mf">2.0384480469e+04</span><span class="p">,</span>
    <span class="mf">2.0097402344e+04</span><span class="p">,</span> <span class="mf">1.9584328125e+04</span><span class="p">,</span> <span class="mf">1.8864750000e+04</span><span class="p">,</span> <span class="mf">1.7961359375e+04</span><span class="p">,</span>
    <span class="mf">1.6899468750e+04</span><span class="p">,</span> <span class="mf">1.5706449219e+04</span><span class="p">,</span> <span class="mf">1.4411125000e+04</span><span class="p">,</span> <span class="mf">1.3043218750e+04</span><span class="p">,</span>
    <span class="mf">1.1632757812e+04</span><span class="p">,</span> <span class="mf">1.0209500000e+04</span><span class="p">,</span> <span class="mf">8.8023554688e+03</span><span class="p">,</span> <span class="mf">7.4388046875e+03</span><span class="p">,</span>
    <span class="mf">6.1443164062e+03</span><span class="p">,</span> <span class="mf">4.9417773438e+03</span><span class="p">,</span> <span class="mf">3.8509133301e+03</span><span class="p">,</span> <span class="mf">2.8876965332e+03</span><span class="p">,</span>
    <span class="mf">2.0637797852e+03</span><span class="p">,</span> <span class="mf">1.3859125977e+03</span><span class="p">,</span> <span class="mf">8.5536181641e+02</span><span class="p">,</span> <span class="mf">4.6733349609e+02</span><span class="p">,</span>
    <span class="mf">2.1039389038e+02</span><span class="p">,</span> <span class="mf">6.5889236450e+01</span><span class="p">,</span> <span class="mf">7.3677425385e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span>
<span class="p">]</span>
<span class="n">b_half_60</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span> <span class="mf">0.0000000000e+00</span><span class="p">,</span>
    <span class="mf">7.5823496445e-05</span><span class="p">,</span> <span class="mf">4.6139489859e-04</span><span class="p">,</span> <span class="mf">1.8151560798e-03</span><span class="p">,</span> <span class="mf">5.0811171532e-03</span><span class="p">,</span>
    <span class="mf">1.1142909527e-02</span><span class="p">,</span> <span class="mf">2.0677875727e-02</span><span class="p">,</span> <span class="mf">3.4121163189e-02</span><span class="p">,</span> <span class="mf">5.1690407097e-02</span><span class="p">,</span>
    <span class="mf">7.3533833027e-02</span><span class="p">,</span> <span class="mf">9.9674701691e-02</span><span class="p">,</span> <span class="mf">1.3002252579e-01</span><span class="p">,</span> <span class="mf">1.6438430548e-01</span><span class="p">,</span>
    <span class="mf">2.0247590542e-01</span><span class="p">,</span> <span class="mf">2.4393314123e-01</span><span class="p">,</span> <span class="mf">2.8832298517e-01</span><span class="p">,</span> <span class="mf">3.3515489101e-01</span><span class="p">,</span>
    <span class="mf">3.8389211893e-01</span><span class="p">,</span> <span class="mf">4.3396294117e-01</span><span class="p">,</span> <span class="mf">4.8477154970e-01</span><span class="p">,</span> <span class="mf">5.3570991755e-01</span><span class="p">,</span>
    <span class="mf">5.8616840839e-01</span><span class="p">,</span> <span class="mf">6.3554745913e-01</span><span class="p">,</span> <span class="mf">6.8326860666e-01</span><span class="p">,</span> <span class="mf">7.2878581285e-01</span><span class="p">,</span>
    <span class="mf">7.7159661055e-01</span><span class="p">,</span> <span class="mf">8.1125342846e-01</span><span class="p">,</span> <span class="mf">8.4737491608e-01</span><span class="p">,</span> <span class="mf">8.7965691090e-01</span><span class="p">,</span>
    <span class="mf">9.0788388252e-01</span><span class="p">,</span> <span class="mf">9.3194031715e-01</span><span class="p">,</span> <span class="mf">9.5182150602e-01</span><span class="p">,</span> <span class="mf">9.6764522791e-01</span><span class="p">,</span>
    <span class="mf">9.7966271639e-01</span><span class="p">,</span> <span class="mf">9.8827010393e-01</span><span class="p">,</span> <span class="mf">9.9401944876e-01</span><span class="p">,</span> <span class="mf">9.9763011932e-01</span><span class="p">,</span>
    <span class="mf">1.0000000000e+00</span>
<span class="p">]</span>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../functions.html#jobs.tools.cams4int2cosmo.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">inpath</span><span class="p">,</span> <span class="n">outpath</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare CAMS CO2, CO and NOx boundary conditions for </span>
<span class="sd">    **int2lm/int2cosmo** for the project SMARTCARB.</span>

<span class="sd">    The CAMS data consists of</span>
<span class="sd">    </span>
<span class="sd">    -   CO2 and CO fields of experiment gf39, class RD (approx. 15 km </span>
<span class="sd">        resolution, 137 levels). See</span>
<span class="sd">        https://atmosphere.copernicus.eu/change-log-gf39</span>
<span class="sd">    -   NO and NO2 from the CAMS operational product, exp 0001, class MC</span>
<span class="sd">        (60 km resolution)</span>

<span class="sd">    The data sets are retrieved as individual 3-hourly files from the MARS</span>
<span class="sd">    archive at ECMWF with names::</span>
<span class="sd">    </span>
<span class="sd">        cams_0001_2015010500.nc   # for NO and NO2</span>
<span class="sd">        sfc_0001_2015010500.nc    # for log of surface pressure</span>
<span class="sd">        cams_gf39_2015010500.nc   # for CO and CO2</span>
<span class="sd">        sfc_gf39_2015010500.nc    # for log of surface pressure</span>

<span class="sd">    The path to the directory of the CAMS data can optionally be supplied, </span>
<span class="sd">    otherwise the script should be invoked in the directory of the CAMS data.</span>

<span class="sd">    The script generates 8 individual 3-hourly IC/BC files::</span>
<span class="sd">    </span>
<span class="sd">        cams_nox_yyyymmddhh.nc</span>
<span class="sd">        cams_co2_yyyymmddhh.nc</span>

<span class="sd">    Usage::</span>
<span class="sd">    </span>
<span class="sd">        python cams4int2cosmo.py date [-i inpath -o outpath]</span>
<span class="sd">        </span>
<span class="sd">    Output:</span>

<span class="sd">         ``cams_NOX_YYYYMMDD00.nc`` to ``cams_NOX_YYYYMMDD21.nc``</span>
<span class="sd">         ``cams_CO2_YYYYMMDD00.nc`` to ``cams_CO2_YYYYMMDD21.nc``</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    date : str</span>
<span class="sd">        date in format YYYYMMDD</span>
<span class="sd">    inpath : str</span>
<span class="sd">        path of original CAMS files (default is current path)</span>
<span class="sd">    outpath : str</span>
<span class="sd">        path where output files should be generated (default is current path)</span>
<span class="sd">    param : dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Creating output directory failed&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="n">tracer2dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;CO2&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;CO2_BG&quot;</span><span class="p">,</span>
                    <span class="n">short_name</span><span class="o">=</span><span class="s2">&quot;co2&quot;</span><span class="p">,</span>
                    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;carbon_dioxide&quot;</span><span class="p">),</span>
        <span class="s1">&#39;CO&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;CO_BG&quot;</span><span class="p">,</span> <span class="n">short_name</span><span class="o">=</span><span class="s2">&quot;co&quot;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;carbon_monoxide&quot;</span><span class="p">),</span>
        <span class="s1">&#39;CH4&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;CH4_BG&quot;</span><span class="p">,</span> <span class="n">short_name</span><span class="o">=</span><span class="s2">&quot;ch4&quot;</span><span class="p">,</span> <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;methane&quot;</span><span class="p">),</span>
        <span class="s1">&#39;NOX&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;NOX_BG&quot;</span><span class="p">,</span>
                    <span class="n">short_name</span><span class="o">=</span><span class="s2">&quot;NOx&quot;</span><span class="p">,</span>
                    <span class="n">long_name</span><span class="o">=</span><span class="s2">&quot;nitrogen_oxide&quot;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">species</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">tracer2dict</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tracer2dict</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Variable &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span>
                          <span class="s2">&quot; is not part of the available list of variables.&quot;</span><span class="p">)</span>

    <span class="n">main_process</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">inpath</span><span class="p">,</span> <span class="n">outpath</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">main_process</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">inpath</span><span class="p">,</span> <span class="n">outpath</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;lev&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">137</span><span class="p">:</span>
        <span class="n">a_half</span> <span class="o">=</span> <span class="n">a_half_137</span>  <span class="c1">#defined globally</span>
        <span class="n">b_half</span> <span class="o">=</span> <span class="n">b_half_137</span>  <span class="c1">#defined globally</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">37</span>  <span class="c1"># only levels 38 to 137 are retrieved from MARS</span>
    <span class="k">elif</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;lev&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">60</span><span class="p">:</span>
        <span class="n">a_half</span> <span class="o">=</span> <span class="n">a_half_60</span>  <span class="c1">#defined globally</span>
        <span class="n">b_half</span> <span class="o">=</span> <span class="n">b_half_60</span>  <span class="c1">#defined globally</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># all levels</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;The list of hybrid parameters for the amount of levels &quot;</span> <span class="o">+</span>
            <span class="n">param</span><span class="p">[</span><span class="s2">&quot;lev&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;is not defined.&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="n">hyam</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a_half</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">a_half</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span>
                           <span class="nb">len</span><span class="p">(</span><span class="n">a_half</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">hybm</span> <span class="o">=</span> <span class="p">[(</span><span class="n">b_half</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b_half</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span>
                           <span class="nb">len</span><span class="p">(</span><span class="n">a_half</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="n">to_print</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;short_name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">))])</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Processing &#39;</span> <span class="o">+</span> <span class="n">to_print</span> <span class="o">+</span> <span class="s1">&#39; for time &#39;</span> <span class="o">+</span>
                 <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H&quot;</span><span class="p">))</span>

    <span class="n">infile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">inpath</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;prefix1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.nc&quot;</span><span class="p">)</span>
    <span class="n">sfcfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">inpath</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;prefix2&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.nc&quot;</span><span class="p">)</span>

    <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">outpath</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;suffix&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.nc&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;file &quot;</span> <span class="o">+</span> <span class="n">infile</span> <span class="o">+</span> <span class="s2">&quot; not found&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">PermissionError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Copying file &quot;</span> <span class="o">+</span> <span class="n">infile</span> <span class="o">+</span> <span class="s2">&quot; failed&quot;</span><span class="p">)</span>
        <span class="k">raise</span>

    <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;NETCDF4&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
        <span class="c1"># copy surface pressure from surface file</span>
        <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">sfcfile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
            <span class="n">lnsp</span> <span class="o">=</span> <span class="n">inf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lnsp&quot;</span><span class="p">]</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;PSURF&quot;</span><span class="p">,</span> <span class="s2">&quot;f8&quot;</span><span class="p">,</span> <span class="n">lnsp</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
            <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;PSURF&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lnsp</span><span class="p">[:])</span>
            <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;PSURF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;surface pressure&quot;</span><span class="p">)</span>
            <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;PSURF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;Pa&quot;</span><span class="p">)</span>

        <span class="c1"># change the calender attribute to proleptic_gregorian</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;calendar&quot;</span><span class="p">,</span> <span class="s2">&quot;proleptic_gregorian&quot;</span><span class="p">)</span>

        <span class="c1"># rename fields according to Carbosense4D definitions</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;NOX_BG&quot;</span><span class="p">:</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">renameVariable</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;short_name&quot;</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Create NOX from NO and NO2</span>
                <span class="n">outf</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;NOX_BG&quot;</span><span class="p">,</span> <span class="s2">&quot;f8&quot;</span><span class="p">,</span> <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;no&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span>
                <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;NOX_BG&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;no&quot;</span><span class="p">][:]</span> <span class="o">+</span> <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;no2&quot;</span><span class="p">][:]</span>

        <span class="n">outf</span><span class="o">.</span><span class="n">renameDimension</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">renameDimension</span><span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">renameVariable</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">renameVariable</span><span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">)</span>

        <span class="c1"># Reverse latitude for all fields so that startlat &lt; endlat</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">dimensions</span>
            <span class="k">if</span> <span class="s1">&#39;lat&#39;</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                <span class="n">lat_ind</span> <span class="o">=</span> <span class="n">dims</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lat_ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">lat_ind</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">lat_ind</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">lat_ind</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">lat_ind</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">outf</span><span class="p">[</span><span class="n">v</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Add the units; these must match those in $int2cosmo/src/trcr_gribtabs.f90</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
            <span class="n">chem</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">long</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;long_name&quot;</span><span class="p">]</span>
            <span class="n">outf</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;kg kg-1&quot;</span><span class="p">)</span>
            <span class="n">outf</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;units_desc&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;kg of substance per kg of dry air&quot;</span><span class="p">)</span>
            <span class="n">outf</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span>
                <span class="s2">&quot;long_name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;mass mixing ratio of &quot;</span> <span class="o">+</span> <span class="n">chem</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; from outside domain&quot;</span><span class="p">)</span>
            <span class="n">outf</span><span class="p">[</span><span class="n">chem</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;standard_name&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot;mass_fraction_of_&quot;</span> <span class="o">+</span> <span class="n">long</span> <span class="o">+</span> <span class="s2">&quot;_in_air&quot;</span><span class="p">)</span>

        <span class="c1"># Add hybrid coefficients</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;hyam&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="s2">&quot;level&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;hybm&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="s2">&quot;level&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;hyam&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">hyam</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;hybm&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">hybm</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;hyam&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;Pa&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;hybm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;hyam&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;long_name&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;hybrid A coefficient at layer midpoints&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;hybm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;long_name&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;hybrid B coefficient at layer midpoints&quot;</span><span class="p">)</span>

        <span class="c1"># create new dimension lev1</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s2">&quot;lev1&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">outf</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;P0&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="s2">&quot;lev1&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;P0&quot;</span><span class="p">][:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;P0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;Pa&quot;</span><span class="p">)</span>
        <span class="n">outf</span><span class="p">[</span><span class="s2">&quot;P0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;reference pressure&quot;</span><span class="p">)</span>

        <span class="c1">#  if NOX_BG, delete no and no2</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NOX_BG&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;no&quot;</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span> <span class="ow">and</span> <span class="s2">&quot;no2&quot;</span> <span class="ow">in</span> <span class="n">outf</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="n">call</span><span class="p">([</span>
                        <span class="s2">&quot;ncks&quot;</span><span class="p">,</span> <span class="s2">&quot;--overwrite&quot;</span><span class="p">,</span> <span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;no,no2&quot;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span>
                        <span class="n">outfile</span>
                    <span class="p">])</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span>
        <span class="s2">&quot;Prepare CAMS CO2, CO, CH4 and NOx boundary conditions for int2lm/int2cosmo&quot;</span><span class="p">,</span>
        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawTextHelpFormatter</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;date in format YYYYMMDD&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;param&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;dictionary of the parameters&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;-i&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;inpath&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;path of original CAMS files (default is current path)&#39;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s1">&#39;-o&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;outpath&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span>
        <span class="s2">&quot;path where output files should be generated (default is inpath/processed)&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">indir</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">o</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indir</span><span class="p">,</span> <span class="s2">&quot;processed&quot;</span><span class="p">))</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">o</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2023, C2SM.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>