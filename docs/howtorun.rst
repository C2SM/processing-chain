.. _howtorun-section:

How to Run
==========

The Python file ``run_chain.py`` in the root directory is the main script of the
Processing Chain.
It reads the user's input from the command line and from the ``config.yaml`` file of the
respective case.
Then it will start the Processing Chain.

Starting the Chain
------------------

The chain has to be run with the following command: ::

    $ python run_chain.py <casename> -j [jobs]

``<casename>`` is the name of a directory in the ``cases/``-directory where
there is a ``config.py``-file specifying the configurations, as well as templates
for the necessary namelist files for **int2lm**, **COSMO** or **ICON**.

If you don't supply a joblist, the default joblist defined in
``config/models.yaml`` will be executed.

The following test cases are available:
* ``cosmo-ghg-spinup-test``
* ``cosmo-ghg-test``
* ``icon-test``
* ``icon-art-oem-test``
* ``icon-art-global-test``

What it Does
------------

The script ``run_chain.py`` reads the command-line arguments and the config-file.
It then calls the function ``run_chain.restart_runs()`` which divides the
simuation time according to the specified restart steps. Then it calls
:func:`run_chain.run_chain` for each sub-run. This function sets up the directory
structure of the chain and then starts the specified :ref:`jobs<jobs-section>`
sequentially.

The directory structure generated by the Processing Chain for a **COSMO** run
looks like this:::

  cfg.work_root/
    + output/cfg.output_root/
    \ <casename>/cfg.chain_root/
                   + cfg.int2lm_base/
		   |   + cfg.int2lm_input/
		   |   + cfg.int2lm_work/
		   |   \ cfg.int2lm_output/
		   + cfg.cosmo_base/
		   |   + cfg.cosmo_work/
		   |   + cfg.cosmo_output/
		   |   \ cfg.cosmo_restart_out/
		   \ checkpoints/
		       + cfg.log_working_dir/
		       \ cfg.log_finished_dir/
                   
Running the ``cosmo-ghg-11km-test``-case therefore produces the following directories:::

  $SCRATCH/processing_chain/
             + output/cosmo-ghg-11km-test
	     \ cosmo-ghg-11km-test/2015010100_0_24/
	                 + int2lm/
			 |   + input/
			 |   |  + emissions/
			 |   |  + extpart/
			 |   |  + prepare_data/
			 |   |  \ vprm/
			 |   + run/
			 |   |  + int2lm   # executable
			 |   |  + INPUT
			 |   |  \ run.job
			 |   \ output/
			 + cosmo/
			 |   + run/
			 |   |  + cosmo    # executable
			 |   |  + INPUT_*
			 |   |  \ run.job
			 |   + output/
			 |   \ restart/
			 \ checkpoints
			     + working/    # 1 logfile per started job
			     \ finished    # 1 logfile per finished job

.. autofunction:: run_chain.restart_runs
